<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resident Profile | ElderConnect OAH</title>
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/nurse.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body>
    <div class="app-container">
        <div class="sidebar">
            <a href="index.html" class="nav-brand">
                <i class="fas fa-hand-holding-medical"></i> ElderConnect
            </a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="oah-dashboard.html" class="nav-link"><i class="fas fa-columns"></i> Overview</a>
                </li>
                <li class="nav-item">
                    <a href="oah-portal.html" class="nav-link"><i class="fas fa-hotel"></i> Manage Home</a>
                </li>
                <li class="nav-item">
                    <a href="oah-inquiries.html" class="nav-link"><i class="fas fa-envelope-open-text"></i>
                        Inquiries</a>
                </li>
                <li class="nav-item">
                    <a href="oah-residents.html" class="nav-link active"><i class="fas fa-users-cog"></i> Resident
                        List</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </li>
            </ul>
        </div>

        <main class="main-content">
            <header class="section-head">
                <h1 class="page-title">Resident Profile</h1>
                <a href="oah-residents.html" class="btn btn-outline">Back to List</a>
            </header>

            <div id="profileContainer" class="animate-fade">
                <p style="text-align: center; padding: 40px; color: var(--text-muted);">Loading profile...</p>
            </div>
        </main>
    </div>

    <script src="../js/main.js"></script>
    <script>
        const API_URL = "http://localhost:8000";

        document.addEventListener("DOMContentLoaded", async () => {
            const userStr = localStorage.getItem("user");
            if (!userStr) { window.location.href = 'login.html'; return; }

            // Get ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const patientId = urlParams.get("id");

            if (!patientId) {
                document.getElementById("profileContainer").innerHTML = "<p>Invalid Resident ID</p>";
                return;
            }

            try {
                const response = await fetch(`${API_URL}/users/${patientId}`);
                if (!response.ok) throw new Error("Failed");
                const patient = await response.json();

                // Also fetch vitals for quick view
                const vitalsRes = await fetch(`${API_URL}/vitals/patient/${patientId}`);
                const vitals = vitalsRes.ok ? await vitalsRes.json() : [];
                const lastVital = vitals.length > 0 ? vitals[vitals.length - 1] : null;

                document.getElementById("profileContainer").innerHTML = `
          <div class="glass-card" style="display: flex; gap: 30px; align-items: start; margin-bottom: 30px;">
            <img src="https://ui-avatars.com/api/?name=${patient.full_name}&background=059669&color=fff&size=150" 
                 style="width: 120px; height: 120px; border-radius: 20px; object-fit: cover;" />
            <div style="flex: 1;">
               <h2 style="font-size: 2rem; font-weight: 800; margin-bottom: 10px;">${patient.full_name}</h2>
               <p style="color: var(--text-muted); margin-bottom: 5px;"><i class="fas fa-envelope"></i> ${patient.email}</p>
               <p style="color: var(--text-muted); margin-bottom: 15px;"><i class="fas fa-phone"></i> ${patient.phone_number || "No phone linked"}</p>
               
               <div style="display: flex; gap: 15px;">
                 <span class="badge badge-success">Active Resident</span>
                 <span class="badge badge-info">Room 304</span>
               </div>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
             <div class="glass-card">
                <h3><i class="fas fa-notes-medical"></i> Recent Vitals</h3>
                ${lastVital ? `
                   <div style="margin-top: 15px;">
                      <p><strong>BP:</strong> ${lastVital.blood_pressure}</p>
                      <p><strong>Heart Rate:</strong> ${lastVital.heart_rate} bpm</p>
                      <p><strong>Sugar:</strong> ${lastVital.sugar_level} mg/dL</p>
                      <p><small class="text-muted">Recorded: ${new Date(lastVital.recorded_at).toLocaleDateString()}</small></p>
                   </div>
                ` : '<p style="margin-top: 15px; color: var(--text-muted);">No recent vitals recorded.</p>'}
             </div>

             <div class="glass-card">
                <h3><i class="fas fa-clipboard-list"></i> Care Preferences</h3>
                <p style="margin-top: 15px; color: var(--text-muted);">
                   Dietary restrictions: None<br>
                   Emergency Contact: Not set
                </p>
             </div>
          </div>
        `;

            } catch (e) {
                console.error(e);
                document.getElementById("profileContainer").innerHTML = "<p>Error loading profile.</p>";
            }
        });
    </script>
</body>

</html>
